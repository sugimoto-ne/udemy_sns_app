{{define "dashboard.html"}}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - ç®¡ç†ç”»é¢</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
    <!-- Header -->
    <nav class="navbar is-dark" role="navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="/admin/dashboard">
                <strong>SNSç®¡ç†ç”»é¢</strong>
            </a>
        </div>
        <div class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <span class="tag is-light">{{.AdminUsername}}</span>
                </div>
                <div class="navbar-item">
                    <form action="/admin/logout" method="POST">
                        <button class="button is-light is-small" type="submit">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <div class="columns is-gapless">
        <!-- Sidebar -->
        <aside class="column is-2 has-background-light" style="min-height: calc(100vh - 52px);">
            <aside class="menu p-4">
                <p class="menu-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</p>
                <ul class="menu-list">
                    <li><a href="/admin/dashboard" class="{{if eq .Active "dashboard"}}is-active{{end}}">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></li>
                    <li><a href="/admin/users" class="{{if eq .Active "users"}}is-active{{end}}">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</a></li>
                    <li><a href="/admin/password-resets" class="{{if eq .Active "password-resets"}}is-active{{end}}">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ</a></li>
                    <li><a href="/admin/logs" class="{{if eq .Active "logs"}}is-active{{end}}">ğŸ“‹ æ“ä½œãƒ­ã‚°</a></li>
                </ul>
            </aside>
        </aside>

        <!-- Main Content -->
        <div class="column">
            <section class="section">
                <!-- Breadcrumb -->
                <nav class="breadcrumb" aria-label="breadcrumbs">
                    <ul>
                        {{range .Breadcrumbs}}
                        <li class="{{if .Active}}is-active{{end}}">
                            <a href="{{.URL}}">{{.Name}}</a>
                        </li>
                        {{end}}
                    </ul>
                </nav>

                <!-- Page Content -->
<h1 class="title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

<!-- ã‚¢ãƒ©ãƒ¼ãƒˆ -->
<div id="alerts-container"></div>

<!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
<div class="columns is-multiline">
    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ -->
    <div class="column is-3">
        <div class="box">
            <p class="heading">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</p>
            <p class="title" id="total-users">-</p>
        </div>
    </div>
    <div class="column is-3">
        <div class="box has-background-warning-light">
            <p class="heading">æ‰¿èªå¾…ã¡</p>
            <p class="title" id="pending-users">-</p>
        </div>
    </div>
    <div class="column is-3">
        <div class="box has-background-success-light">
            <p class="heading">æ‰¿èªæ¸ˆã¿</p>
            <p class="title" id="approved-users">-</p>
        </div>
    </div>
    <div class="column is-3">
        <div class="box has-background-danger-light">
            <p class="heading">æ‹’å¦æ¸ˆã¿</p>
            <p class="title" id="rejected-users">-</p>
        </div>
    </div>

    <!-- æŠ•ç¨¿çµ±è¨ˆ -->
    <div class="column is-4">
        <div class="box">
            <p class="heading">ç·æŠ•ç¨¿æ•°</p>
            <p class="title" id="total-posts">-</p>
        </div>
    </div>
    <div class="column is-4">
        <div class="box">
            <p class="heading">æœ¬æ—¥ã®æŠ•ç¨¿</p>
            <p class="title" id="today-posts">-</p>
        </div>
    </div>
    <div class="column is-4">
        <div class="box">
            <p class="heading">ãƒ¡ãƒ‡ã‚£ã‚¢ä»˜ãæŠ•ç¨¿ç‡</p>
            <p class="title" id="media-rate">-</p>
        </div>
    </div>

    <!-- ãã®ä»–çµ±è¨ˆ -->
    <div class="column is-6">
        <div class="box">
            <p class="heading">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ7æ—¥é–“ï¼‰</p>
            <p class="title" id="active-users">-</p>
        </div>
    </div>
    <div class="column is-6">
        <div class="box">
            <p class="heading">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”³è«‹ï¼ˆæœªå‡¦ç†ï¼‰</p>
            <p class="title" id="password-reset-pending">-</p>
        </div>
    </div>
</div>

<!-- ã‚°ãƒ©ãƒ• -->
<div class="columns">
    <div class="column is-6">
        <div class="box">
            <h2 class="subtitle">æŠ•ç¨¿æ•°æ¨ç§»ï¼ˆç›´è¿‘30æ—¥ï¼‰</h2>
            <canvas id="postsChart"></canvas>
        </div>
    </div>
    <div class="column is-6">
        <div class="box">
            <h2 class="subtitle">æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨ç§»ï¼ˆç›´è¿‘30æ—¥ï¼‰</h2>
            <canvas id="usersChart"></canvas>
        </div>
    </div>
</div>

<script>
// çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
async function loadDashboardStats() {
    const response = await fetch('/admin/api/dashboard/stats');
    const result = await response.json();
    const data = result.data;

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ
    document.getElementById('total-users').textContent = data.users.total.toLocaleString();
    document.getElementById('pending-users').textContent = data.users.pending.toLocaleString();
    document.getElementById('approved-users').textContent = data.users.approved.toLocaleString();
    document.getElementById('rejected-users').textContent = data.users.rejected.toLocaleString();

    // æŠ•ç¨¿çµ±è¨ˆ
    document.getElementById('total-posts').textContent = data.posts.total.toLocaleString();
    document.getElementById('today-posts').textContent = data.posts.today.toLocaleString();
    document.getElementById('media-rate').textContent = data.posts.with_media_rate.toFixed(1) + '%';

    // ãã®ä»–
    document.getElementById('active-users').textContent = data.active_users_7d.toLocaleString();
    document.getElementById('password-reset-pending').textContent = data.password_reset_pending.toLocaleString();

    // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
    const alertsContainer = document.getElementById('alerts-container');
    data.alerts.forEach(alert => {
        const notification = document.createElement('div');
        notification.className = 'notification is-warning';
        notification.innerHTML = `<strong>âš ï¸ ${alert.message}</strong> (${alert.count}ä»¶)`;
        alertsContainer.appendChild(notification);
    });
}

// ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
async function loadPostsChart() {
    const response = await fetch('/admin/api/dashboard/charts/posts');
    const result = await response.json();
    const data = result.data;

    const ctx = document.getElementById('postsChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'æŠ•ç¨¿æ•°',
                data: data.values,
                borderColor: '#00d1b2',
                backgroundColor: 'rgba(0, 209, 178, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: true
                }
            }
        }
    });
}

async function loadUsersChart() {
    const response = await fetch('/admin/api/dashboard/charts/users');
    const result = await response.json();
    const data = result.data;

    const ctx = document.getElementById('usersChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼',
                data: data.values,
                borderColor: '#3273dc',
                backgroundColor: 'rgba(50, 115, 220, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: true
                }
            }
        }
    });
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
document.addEventListener('DOMContentLoaded', () => {
    loadDashboardStats();
    loadPostsChart();
    loadUsersChart();
});
</script>

            </section>
        </div>
    </div>

    <script src="/static/js/admin.js"></script>
</body>
</html>
{{end}}
