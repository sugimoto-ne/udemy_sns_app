# SNSアプリケーション 動作確認テストシナリオ

## 📋 目次

1. [事前準備](#事前準備)
2. [基本シナリオ](#基本シナリオ)
3. [詳細テストシナリオ](#詳細テストシナリオ)
4. [エラーケーステスト](#エラーケーステスト)
5. [チェックリスト](#チェックリスト)

---

## 事前準備

### 1. バックエンドの起動

```bash
cd /Users/sugimoto/Desktop/udemy/sns/backend

# データベース起動
docker compose up -d

# バックエンドサーバー起動
go run cmd/main.go
```

**確認ポイント:**
- ✅ PostgreSQLコンテナが起動している
- ✅ バックエンドサーバーが `http://localhost:8080` で起動している
- ✅ コンソールに "Server started on :8080" などのメッセージが表示される

### 2. フロントエンドの起動

```bash
cd /Users/sugimoto/Desktop/udemy/sns/frontend

# 開発サーバー起動
npm run dev
```

**確認ポイント:**
- ✅ 開発サーバーが `http://localhost:5173` で起動している
- ✅ ブラウザで自動的に開く（または手動でアクセス）

### 3. 環境変数の確認

**バックエンド（`.env`）:**
```env
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=sns_db
JWT_SECRET=your-secret-key-change-in-production
PORT=8080
```

**フロントエンド（`frontend/.env.local`）:**
```env
VITE_API_BASE_URL=http://localhost:8080/api/v1
```

---

## 基本シナリオ

### シナリオ1: 新規ユーザー登録からタイムライン表示まで

#### ステップ1: ユーザー登録

1. ブラウザで `http://localhost:5173` にアクセス
2. ログインページが表示される
3. 「新規登録」リンクをクリック
4. 登録フォームに以下を入力:
   - ユーザー名: `testuser1`
   - メールアドレス: `testuser1@example.com`
   - パスワード: `password123`
   - パスワード（確認）: `password123`
5. 「新規登録」ボタンをクリック

**期待される結果:**
- ✅ ホームページ（タイムライン）にリダイレクトされる
- ✅ 右上にユーザーアバターが表示される
- ✅ 「まだ投稿がありません」というメッセージが表示される

**確認するエラー:**
- ❌ 同じユーザー名で再登録しようとすると「すでに使用されています」エラーが表示される
- ❌ パスワードが一致しない場合、エラーメッセージが表示される

---

#### ステップ2: 投稿を作成

1. ホームページ上部の投稿フォームに以下を入力:
   ```
   これは最初の投稿です！#テスト
   ```
2. 「投稿する」ボタンをクリック

**期待される結果:**
- ✅ 投稿がタイムラインに即座に表示される
- ✅ 投稿カードに以下が表示される:
  - ユーザー名（`testuser1`）
  - 投稿内容
  - いいね数（0）
  - コメント数（0）
  - 投稿時刻（「〜秒前」など）
  - 削除ボタン（自分の投稿なので表示される）

---

#### ステップ3: 複数の投稿を作成

以下の投稿を順番に作成:

```
投稿2: こんにちは、みなさん！
投稿3: 今日はいい天気ですね ☀️
投稿4: SNSアプリのテスト中です
```

**期待される結果:**
- ✅ タイムラインに4つの投稿が新しい順に表示される
- ✅ 最新の投稿が一番上に表示される

---

### シナリオ2: 2人目のユーザーでログイン・交流

#### ステップ1: 新しいブラウザウィンドウで2人目のユーザーを登録

1. **新しいシークレットウィンドウ**（または別のブラウザ）を開く
2. `http://localhost:5173` にアクセス
3. 新規登録:
   - ユーザー名: `testuser2`
   - メールアドレス: `testuser2@example.com`
   - パスワード: `password123`
4. 登録完了後、ホームページに移動

**期待される結果:**
- ✅ `testuser2` としてログインできる
- ✅ タイムラインに `testuser1` の4つの投稿が表示される

---

#### ステップ2: いいね機能をテスト

1. `testuser1` の投稿（「これは最初の投稿です！#テスト」）のいいねボタン（ハートアイコン）をクリック

**期待される結果:**
- ✅ ハートアイコンが塗りつぶされる（色が変わる）
- ✅ いいね数が `0` → `1` に増加する
- ✅ もう一度クリックすると、いいねが解除される（数が `1` → `0`）

---

#### ステップ3: コメント機能をテスト

1. `testuser1` の投稿をクリックして投稿詳細ページに移動
2. コメントフォームに以下を入力:
   ```
   素晴らしい投稿ですね！
   ```
3. 「コメント」ボタンをクリック

**期待される結果:**
- ✅ コメントがコメント一覧に即座に表示される
- ✅ コメントに以下が表示される:
  - ユーザー名（`testuser2`）
  - コメント内容
  - 投稿時刻
  - 削除ボタン（自分のコメントなので表示される）
- ✅ 投稿カードのコメント数が `0` → `1` に増加する

---

#### ステップ4: フォロー機能をテスト

1. 投稿カードの `testuser1` のユーザー名をクリック
2. `testuser1` のプロフィールページに移動
3. 「フォロー」ボタンをクリック

**期待される結果:**
- ✅ ボタンが「フォロー中」に変わる
- ✅ フォロワー数が `0` → `1` に増加する
- ✅ もう一度クリックすると、フォロー解除される

---

#### ステップ5: testuser2 で投稿を作成

1. ホームページに戻る
2. 以下の投稿を作成:
   ```
   testuser2 です。よろしくお願いします！
   ```

**期待される結果:**
- ✅ 投稿がタイムラインに表示される
- ✅ タイムラインに `testuser1` と `testuser2` の投稿が混在して表示される

---

### シナリオ3: testuser1 でログアウト・再ログイン

#### ステップ1: ログアウト

1. 元のウィンドウ（`testuser1` でログイン中）に戻る
2. 右上のアバターアイコンをクリック
3. メニューから「ログアウト」をクリック

**期待される結果:**
- ✅ ログインページにリダイレクトされる
- ✅ LocalStorageからトークンとユーザー情報が削除される

---

#### ステップ2: 再ログイン

1. ログインフォームに以下を入力:
   - メールアドレス: `testuser1@example.com`
   - パスワード: `password123`
2. 「ログイン」ボタンをクリック

**期待される結果:**
- ✅ ホームページにリダイレクトされる
- ✅ タイムラインに5つの投稿が表示される（testuser1の4つ + testuser2の1つ）
- ✅ 自分の投稿には削除ボタンが表示される

---

#### ステップ3: プロフィールページの確認

1. 右上のアバターアイコンをクリック
2. メニューから「プロフィール」をクリック

**期待される結果:**
- ✅ `testuser1` のプロフィールページに移動する
- ✅ 以下が表示される:
  - ユーザー名: `testuser1`
  - フォロー数: `0`（まだ誰もフォローしていない）
  - フォロワー数: `1`（testuser2がフォロー中）
  - 投稿一覧: 4つの投稿

---

#### ステップ4: testuser2 をフォロー

1. タイムラインに戻る
2. `testuser2` の投稿のユーザー名をクリック
3. `testuser2` のプロフィールページで「フォロー」ボタンをクリック

**期待される結果:**
- ✅ ボタンが「フォロー中」に変わる
- ✅ `testuser2` のフォロワー数が `0` → `1` に増加する

---

## 詳細テストシナリオ

### シナリオ4: 投稿の削除

1. ホームページに戻る
2. 自分の投稿（例: 「投稿4: SNSアプリのテスト中です」）の削除ボタン（ゴミ箱アイコン）をクリック
3. 確認ダイアログで「OK」をクリック

**期待される結果:**
- ✅ 投稿がタイムラインから即座に削除される
- ✅ タイムラインの投稿数が減る

---

### シナリオ5: コメントの削除

1. 自分がコメントした投稿の詳細ページに移動
2. 自分のコメントの削除ボタンをクリック
3. 確認ダイアログで「OK」をクリック

**期待される結果:**
- ✅ コメントが即座に削除される
- ✅ 投稿のコメント数が減る

---

### シナリオ6: 複数のいいねとコメント

1. 複数のユーザーで同じ投稿にいいねをする
2. 複数のユーザーで同じ投稿にコメントをする

**期待される結果:**
- ✅ いいね数が正しくカウントされる
- ✅ コメント数が正しくカウントされる
- ✅ コメント一覧に複数のコメントが表示される

---

## エラーケーステスト

### テスト1: バリデーションエラー

#### 新規登録時:
1. ユーザー名を2文字以下で登録しようとする
   - **期待**: 「ユーザー名は3文字以上で入力してください」エラー
2. 無効なメールアドレス（例: `test@`）で登録しようとする
   - **期待**: 「有効なメールアドレスを入力してください」エラー
3. パスワードを5文字以下で登録しようとする
   - **期待**: 「パスワードは6文字以上で入力してください」エラー

#### 投稿作成時:
1. 空の投稿を作成しようとする
   - **期待**: 「投稿内容を入力してください」エラー
2. 281文字以上の投稿を作成しようとする
   - **期待**: 「投稿は280文字以内で入力してください」エラー

---

### テスト2: 認証エラー

1. ログアウトした状態でブラウザのLocalStorageを確認
   - **期待**: `auth_token` と `auth_user` が削除されている
2. 手動で `/` にアクセスしようとする
   - **期待**: ログインページにリダイレクトされる
3. 間違ったパスワードでログインしようとする
   - **期待**: 「ログインに失敗しました」エラー

---

### テスト3: 権限エラー

1. `testuser1` でログイン
2. `testuser2` の投稿の削除ボタンを確認
   - **期待**: 削除ボタンが表示されない
3. `testuser2` のコメントの削除ボタンを確認
   - **期待**: 削除ボタンが表示されない

---

## チェックリスト

### 認証機能
- [ ] 新規登録ができる
- [ ] ログインができる
- [ ] ログアウトができる
- [ ] 認証エラー時に適切なエラーメッセージが表示される
- [ ] 未認証時にプライベートページにアクセスするとログインページにリダイレクトされる
- [ ] LocalStorageにトークンが保存される

### 投稿機能
- [ ] 投稿を作成できる
- [ ] 投稿を削除できる（自分の投稿のみ）
- [ ] 投稿がタイムラインに表示される
- [ ] 投稿詳細ページが表示される
- [ ] 投稿時刻が表示される
- [ ] 投稿のバリデーションが機能する

### いいね機能
- [ ] 投稿にいいねできる
- [ ] いいねを解除できる
- [ ] いいね数が正しく表示される
- [ ] いいね状態がアイコンで視覚的にわかる

### コメント機能
- [ ] コメントを作成できる
- [ ] コメントを削除できる（自分のコメントのみ）
- [ ] コメント一覧が表示される
- [ ] コメント数が正しく表示される
- [ ] コメントのバリデーションが機能する

### フォロー機能
- [ ] ユーザーをフォローできる
- [ ] フォローを解除できる
- [ ] フォロー数・フォロワー数が正しく表示される
- [ ] フォロー状態がボタンで視覚的にわかる

### プロフィール機能
- [ ] ユーザープロフィールページが表示される
- [ ] ユーザーの投稿一覧が表示される
- [ ] フォロー数・フォロワー数が表示される
- [ ] 他のユーザーのプロフィールを閲覧できる

### UI/UX
- [ ] ローディング中にスピナーが表示される
- [ ] エラー時に適切なエラーメッセージが表示される
- [ ] レスポンシブデザインが機能する（モバイル・タブレット・デスクトップ）
- [ ] アバターが表示される（またはデフォルトアバター）
- [ ] 日時が適切にフォーマットされている（「〜秒前」など）

### データの永続性
- [ ] ページをリロードしてもログイン状態が維持される
- [ ] 投稿・いいね・コメント・フォローがデータベースに保存される
- [ ] ログアウトして再ログインしてもデータが保持される

---

## トラブルシューティング

### よくある問題

#### 1. CORSエラー
**症状**: ブラウザのコンソールに "CORS policy" エラーが表示される

**解決策**:
- バックエンドでCORS設定を確認
- フロントエンドの `.env.local` で `VITE_API_BASE_URL` が正しいか確認

#### 2. 認証エラー (401)
**症状**: API呼び出し時に401エラーが返される

**解決策**:
- LocalStorageに `auth_token` が保存されているか確認
- トークンの有効期限を確認
- ログアウトして再ログイン

#### 3. データベース接続エラー
**症状**: バックエンドが起動しない、または "connection refused" エラー

**解決策**:
```bash
# PostgreSQLコンテナの状態を確認
docker ps

# コンテナを再起動
docker compose down
docker compose up -d
```

#### 4. フロントエンドがAPIに接続できない
**症状**: ネットワークエラーが表示される

**解決策**:
- バックエンドが起動しているか確認（`http://localhost:8080`）
- `.env.local` の `VITE_API_BASE_URL` を確認
- 開発サーバーを再起動

---

## テスト完了後の確認事項

すべてのテストが完了したら、以下を確認してください:

1. **データベースの確認**:
   ```bash
   docker exec -it sns-postgres psql -U postgres -d sns_db
   ```
   ```sql
   -- ユーザー数を確認
   SELECT COUNT(*) FROM users;

   -- 投稿数を確認
   SELECT COUNT(*) FROM posts;

   -- いいね数を確認
   SELECT COUNT(*) FROM likes;

   -- コメント数を確認
   SELECT COUNT(*) FROM comments;

   -- フォロー関係を確認
   SELECT COUNT(*) FROM follows;
   ```

2. **ブラウザの開発者ツールで確認**:
   - Network タブでAPI呼び出しを確認
   - Console タブでエラーがないか確認
   - Application タブでLocalStorageを確認

3. **バックエンドのログを確認**:
   - コンソールにエラーログが出力されていないか確認
   - SQLクエリが正しく実行されているか確認

---

**テスト実施日**: _______________
**テスト実施者**: _______________
**結果**: ✅ 合格 / ❌ 不合格
**備考**: _______________

